generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SalesOrder {
  id              String          @id @default(uuid())
  orderNumber     String          @unique @map("order_number")
  customerId      String          @map("customer_id")
  customerName    String          @map("customer_name")
  orderDate       DateTime        @map("order_date")
  dueDate         DateTime        @map("due_date")
  subtotal        Decimal         @db.Decimal(15, 2)
  taxAmount       Decimal         @default(0) @map("tax_amount") @db.Decimal(15, 2)
  discountAmount  Decimal         @default(0) @map("discount_amount") @db.Decimal(15, 2)
  totalAmount     Decimal         @map("total_amount") @db.Decimal(15, 2)
  paidAmount      Decimal         @default(0) @map("paid_amount") @db.Decimal(15, 2)
  balanceAmount   Decimal         @map("balance_amount") @db.Decimal(15, 2)
  status          OrderStatus     @default(DRAFT)
  paymentStatus   PaymentStatus   @default(UNPAID) @map("payment_status")
  currency        String          @default("USD") @db.VarChar(3)
  notes           String?
  termsConditions String?         @map("terms_conditions")
  metadata        Json?
  items           SalesOrderItem[]
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")

  @@map("sales_orders")
}

model SalesOrderItem {
  id            String      @id @default(uuid())
  orderId       String      @map("order_id")
  order         SalesOrder  @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId     String      @map("product_id")
  productName   String      @map("product_name")
  productSku    String?     @map("product_sku")
  quantity      Decimal     @db.Decimal(10, 2)
  unitPrice     Decimal     @map("unit_price") @db.Decimal(15, 2)
  discountAmount Decimal    @default(0) @map("discount_amount") @db.Decimal(15, 2)
  taxAmount     Decimal     @default(0) @map("tax_amount") @db.Decimal(15, 2)
  lineTotal     Decimal     @map("line_total") @db.Decimal(15, 2)
  description   String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  @@map("sales_order_items")
}

enum OrderStatus {
  DRAFT
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  UNPAID
  PARTIALLY_PAID
  PAID
  OVERPAID
  REFUNDED
}
